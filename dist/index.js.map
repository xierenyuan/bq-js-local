{"version":3,"file":"index.js","sources":["../node_modules/immediate/lib/index.js","../node_modules/lie/lib/index.js","../src/local.js","../src/index.js"],"sourcesContent":["'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\nif (process.browser) {\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n} else {\n  scheduleDrain = function () {\n    process.nextTick(nextTick);\n  };\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","'use strict';\nvar immediate = require('immediate');\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n/* istanbul ignore else */\nif (!process.browser) {\n  // in which we actually take advantage of JS scoping\n  var UNHANDLED = ['UNHANDLED'];\n}\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  /* istanbul ignore else */\n  if (!process.browser) {\n    this.handled = UNHANDLED;\n  }\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype.catch = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  /* istanbul ignore else */\n  if (!process.browser) {\n    if (this.handled === UNHANDLED) {\n      this.handled = null;\n    }\n  }\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  /* istanbul ignore else */\n  if (!process.browser) {\n    if (self.handled === UNHANDLED) {\n      immediate(function () {\n        if (self.handled === UNHANDLED) {\n          process.emit('unhandledRejection', error, self);\n        }\n      });\n    }\n  }\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n","import Promise from 'lie'\nlet head = document.head || document.getElementsByTagName('head')[0]\n//////////////////////////////////////////////////////////////////////////////\n// helpers\n\nvar _isArray = Array.isArray || function isArray(obj) {\n  return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\n\nfunction _each(obj, iterator) {\n  if (_isArray(obj)) {\n    if (obj.forEach) return obj.forEach(iterator);\n\n    for (var i = 0; i < obj.length; i++) iterator(obj[i], i, obj);\n  } else {\n    for (var k in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, k)) iterator(obj[k], k);\n    }\n  }\n}\n\nfunction _default(obj, src) {\n  // extend obj with src properties if not exists;\n  _each(src, function (val, key) {\n    if (!obj[key]) obj[key] = src[key];\n  });\n  return obj;\n}\n/////////////////////////////////////////////////////////////////////////////\nvar P = Promise;\n//////////////////////////////////////////////////////////////////////////////\n  // Adapters for Store class\n\n  function DomStorage(namespace) {\n    var self = this;\n    var _ns = namespace + '__';\n\n    this.init = function () { return P.resolve(); };\n\n    this.remove = function (key) {\n      localStorage.removeItem(_ns + key);\n      return P.resolve();\n    };\n\n\n    this.set = function (key, value, expire) {\n      var obj = {\n        value: value,\n        expire: expire\n      };\n\n      return new P(function (resolve, reject) {\n        try {\n          localStorage.setItem(_ns + key, JSON.stringify(obj));\n          resolve();\n        } catch (e) {\n          // On quota error try to reset storage & try again.\n          // Just remove all keys, without conditions, no optimizations needed.\n          if (e.name.toUpperCase().indexOf('QUOTA') >= 0) {\n            try {\n              _each(localStorage, function (val, name) {\n                var k = name.split(_ns)[1];\n                if (k) { self.remove(k); }\n              });\n              localStorage.setItem(_ns + key, JSON.stringify(obj));\n              resolve();\n            } catch (e2) {\n              reject(e2);\n            }\n          } else {\n            reject(e);\n          }\n        }\n      });\n    };\n\n\n    this.get = function (key, raw) {\n      return new P(function (resolve, reject) {\n        try {\n          var data = localStorage.getItem(_ns + key);\n\n          // return `undefined` for missed keys\n          if (data === null) return resolve();\n\n          data = JSON.parse(localStorage.getItem(_ns + key));\n\n          resolve(data = raw ? data : data.value);\n        } catch (e) {\n          reject(new Error(\"Can't read key: \" + key));\n        }\n      });\n    };\n\n\n    this.clear = function (expiredOnly) {\n      var now = +new Date();\n      var p = P.resolve();\n\n      _each(localStorage, function (val, name) {\n        var key = name.split(_ns)[1];\n\n        if (!key) return;\n\n        if (!expiredOnly) {\n          p = p.then(function () { self.remove(key); });\n          return;\n        }\n\n        p = p.then(function () {\n          return self.get(key, true)\n            .then(function (raw) {\n              if (raw && (raw.expire > 0) && ((raw.expire - now) < 0)) {\n                // no need to chain promise, because operation is sync\n                self.remove(key);\n              }\n            });\n        });\n      });\n\n      return p;\n    };\n  }\n\n\n  DomStorage.exists = function () {\n    try {\n      localStorage.setItem('__ls_test__', '__ls_test__');\n      localStorage.removeItem('__ls_test__');\n      return true;\n    } catch (e) {\n      return false;\n    }\n  };\n\n\n\n  function WebSql(namespace) {\n    var db;\n\n\n    this.init = function () {\n      return new P(function (resolve, reject) {\n        db = window.openDatabase(namespace, '1.0', 'bag.js db', 2e5);\n\n        if (!db) {\n          reject(\"Can't open websql database\");\n          return;\n        }\n\n        db.transaction(function (tx) {\n          tx.executeSql(\n            'CREATE TABLE IF NOT EXISTS kv (key TEXT PRIMARY KEY, value TEXT, expire INTEGER KEY)',\n            [],\n            function () { resolve(); },\n            function (tx, err) { reject(err); }\n          );\n        });\n      });\n    };\n\n\n    this.remove = function (key) {\n      return new P(function (resolve, reject) {\n        db.transaction(function (tx) {\n          tx.executeSql(\n            'DELETE FROM kv WHERE key = ?',\n            [ key ],\n            function () { resolve(); },\n            function (tx, err) { reject(err); }\n          );\n        });\n      });\n    };\n\n\n    this.set = function (key, value, expire) {\n      return new P(function (resolve, reject) {\n        db.transaction(function (tx) {\n          tx.executeSql(\n            'INSERT OR REPLACE INTO kv (key, value, expire) VALUES (?, ?, ?)',\n            [ key, JSON.stringify(value), expire ],\n            function () { resolve(); },\n            function (tx, err) { reject(err); }\n          );\n        });\n      });\n    };\n\n\n    this.get = function (key) {\n      return new P(function (resolve, reject) {\n        db.readTransaction(function (tx) {\n          tx.executeSql(\n            'SELECT value FROM kv WHERE key = ?',\n            [ key ],\n            function (tx, result) {\n              // return `undefined` for missed keys\n              if (result.rows.length === 0) return resolve();\n\n              var value = result.rows.item(0).value;\n\n              try {\n                resolve(JSON.parse(value));\n              } catch (e) {\n                reject(new Error(\"Can't unserialise data: \" + value));\n              }\n            },\n            function (tx, err) { reject(err); }\n          );\n        });\n      });\n    };\n\n\n    this.clear = function (expiredOnly) {\n      return new P(function (resolve, reject) {\n        db.transaction(function (tx) {\n          tx.executeSql(\n            expiredOnly ?\n              'DELETE FROM kv WHERE expire > 0 AND expire < ?'\n            :\n              'DELETE FROM kv',\n            expiredOnly ? [ +new Date() ] : [],\n            function () { resolve(); },\n            function (tx, err) { reject(err); }\n          );\n        });\n      });\n    };\n  }\n\n\n  WebSql.exists = function () { return (!!window.openDatabase); };\n\n\n\n  function Idb(namespace) {\n    var db;\n\n    this.init = function () {\n      return new P(function (resolve, reject) {\n        var idb = window.indexedDB;\n\n        var req = idb.open(namespace, 2 /*version*/);\n\n        req.onsuccess = function (e) {\n          db = e.target.result;\n          resolve();\n        };\n        req.onblocked = function (e) {\n          reject(new Error('IndexedDB blocked. ' + e.target.errorCode));\n        };\n        req.onerror = function (e) {\n          reject(new Error('IndexedDB opening error. ' + e.target.errorCode));\n        };\n        req.onupgradeneeded = function (e) {\n          db = e.target.result;\n\n          if (db.objectStoreNames.contains('kv')) db.deleteObjectStore('kv');\n\n          var store = db.createObjectStore('kv', { keyPath: 'key' });\n\n          store.createIndex('expire', 'expire', { unique: false });\n        };\n      });\n    };\n\n\n    this.remove = function (key) {\n      return new P(function (resolve, reject) {\n        var tx = db.transaction('kv', 'readwrite');\n\n        tx.oncomplete = function () { resolve(); };\n        tx.onerror = tx.onabort = function (e) { reject(e.target); };\n\n        // IE 8 not allow to use reserved keywords as functions. More info:\n        // http://tiffanybbrown.com/2013/09/10/expected-identifier-bug-in-internet-explorer-8/\n        tx.objectStore('kv')['delete'](key).onerror = function () {\n          tx.abort();\n        };\n      });\n    };\n\n\n    this.set = function (key, value, expire) {\n      return new P(function (resolve, reject) {\n        var tx = db.transaction('kv', 'readwrite');\n\n        tx.oncomplete = function () { resolve(); };\n        tx.onerror = tx.onabort = function (e) { reject(e.target); };\n\n        tx.objectStore('kv').put({\n          key: key,\n          value: value,\n          expire: expire\n        }).onerror = function () { tx.abort(); };\n      });\n    };\n\n\n    this.get = function (key) {\n      return new P(function (resolve, reject) {\n        var tx = db.transaction('kv');\n\n        // tx.oncomplete = function () { resolve(result); };\n        tx.onerror = tx.onabort = function (e) {\n          reject(new Error('Key get error: ' + e.target));\n        };\n\n        tx.objectStore('kv').get(key).onsuccess = function (e) {\n          if (e.target.result) resolve(e.target.result.value);\n          else resolve();\n        };\n      });\n    };\n\n\n    this.clear = function (expiredOnly) {\n      return new P(function (resolve, reject) {\n        var keyrange = window.IDBKeyRange,\n            tx       = db.transaction('kv', 'readwrite'),\n            store    = tx.objectStore('kv');\n\n        tx = db.transaction('kv', 'readwrite');\n        store = tx.objectStore('kv');\n\n        tx.oncomplete = function () { resolve(); };\n        tx.onerror = tx.onabort = function (e) {\n          reject(new Error('Clear error: ', e.target));\n        };\n\n        if (expiredOnly) {\n          var cursor = store.index('expire').openCursor(keyrange.bound(1, +new Date()));\n\n          cursor.onsuccess = function (e) {\n            var _cursor = e.target.result;\n            if (_cursor) {\n              // IE 8 not allow to use reserved keywords as functions (`delete` and `continue`). More info:\n              // http://tiffanybbrown.com/2013/09/10/expected-identifier-bug-in-internet-explorer-8/\n              store['delete'](_cursor.primaryKey).onerror = function () {\n                tx.abort();\n              };\n              _cursor['continue']();\n            }\n          };\n\n          return;\n        }\n\n        // Just clear everything\n        tx.objectStore('kv').clear().onerror = function () { tx.abort(); };\n      });\n    };\n  }\n\n\n  Idb.exists = function () {\n    var db =  window.indexedDB;\n\n    if (!db) return false;\n\n    // Check outdated idb implementations, where `onupgradeneede` event doesn't work,\n    // see https://github.com/pouchdb/pouchdb/issues/1207 for more details\n    var dbName = '__idb_test__';\n    var result = db.open(dbName, 1).onupgradeneeded === null;\n\n    if (db.deleteDatabase) db.deleteDatabase(dbName);\n\n    return result;\n  };\n\n\n\n  /////////////////////////////////////////////////////////////////////////////\n  // key/value storage with expiration\n\n  var storeAdapters = {\n    indexeddb: Idb,\n    websql: WebSql,\n    localstorage: DomStorage\n  };\n\n\n  // namespace - db name or similar\n  // storesList - array of allowed adapter names to use\n  //\n  function Storage(namespace, storesList) {\n    var db = null;\n    // var init_done = false;\n\n    _each(storesList, function (name) {\n      // do storage names case insensitive\n      name = name.toLowerCase();\n\n      if (!storeAdapters[name]) {\n        throw new Error('Wrong storage adapter name: ' + name, storesList);\n      }\n\n      if (storeAdapters[name].exists() && !db) {\n        db = new storeAdapters[name](namespace);\n        return false; // terminate search on first success\n      }\n    });\n\n    if (!db) {\n      /* eslint-disable no-console */\n      // If no adaprets - don't make error for correct fallback.\n      // Just log that we continue work without storing results.\n      if (typeof console !== 'undefined' && console.log) {\n        console.log('None of requested storages available: ' + storesList);\n      }\n      /* eslint-enable no-console */\n    }\n\n    function createInit() {\n      return P.resolve()\n        .then(function () {\n          if (!db) throw new Error('No available db');\n          return db.init().then(function () {\n            // init_done = true;\n            db.clear(true); // clear expired\n          });\n        });\n    }\n\n    var _waitInit;\n\n    this.init = function () {\n      if (!_waitInit) _waitInit = createInit();\n      return _waitInit;\n    };\n\n\n    this.set = function (key, value, expire) {\n      return this.init().then(function () {\n        return db.set(key, value, expire ? +(new Date()) + (expire * 1000) : 0);\n      });\n    };\n\n\n    this.get = function (key) {\n      return this.init().then(function () { return db.get(key); });\n    };\n\n\n    this.remove = function (key) {\n      return this.init().then(function () { return db.remove(key); });\n    };\n\n\n    this.clear = function (expiredOnly) {\n      return this.init().then(function () { return db.clear(expiredOnly); });\n    };\n  }\n\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Bag class implementation\n\n  function Bag(options) {\n    if (!(this instanceof Bag)) return new Bag(options);\n\n    var self = this;\n\n    options = options || {};\n\n    this.prefix       = options.prefix || 'bag';\n    this.timeout      = options.timeout || 20;    // 20 seconds\n    this.expire       = options.expire || 30 * 24;  // 30 days\n    this.isValidItem  = options.isValidItem || null;\n\n    this.stores = _isArray(options.stores) ? options.stores : [ 'indexeddb', 'websql', 'localstorage' ];\n\n    var storage = null;\n\n    function createStorage() {\n      if (!storage) storage = new Storage(self.prefix, self.stores);\n    }\n\n    function getUrl(url) {\n      return new P(function (resolve, reject) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', url);\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200) {\n              resolve({\n                content: xhr.responseText,\n                type: xhr.getResponseHeader('content-type')\n              });\n            } else {\n              reject(new Error(\"Can't open url \" + url +\n                 (xhr.status ? xhr.statusText + ' (' + xhr.status + ')' : '')));\n            }\n          }\n        };\n\n        setTimeout(function () {\n          if (xhr.readyState < 4) {\n            xhr.abort();\n            reject(new Error('Timeout'));\n          }\n        }, self.timeout * 1000);\n\n        try {\n          xhr.send();\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n\n    function createCacheObj(obj, response) {\n      var cacheObj = {};\n\n      _each([ 'url', 'key', 'unique' ], function (key) {\n        if (obj[key]) cacheObj[key] = obj[key];\n      });\n\n      var now = +new Date();\n\n      cacheObj.data = response.content;\n      cacheObj.originalType = response.type;\n      cacheObj.type = obj.type || response.type;\n      cacheObj.stamp = now;\n\n      return cacheObj;\n    }\n\n    function saveUrl(obj) {\n      return getUrl(obj.url_real)\n        .then(function (result) {\n          var delay = (obj.expire || self.expire) * 60 * 60; // in seconds\n          var cached = createCacheObj(obj, result);\n\n          return storage.set(obj.key, cached, delay)\n            // Suppress error - have to return data anyway\n            .then(\n              function () { return _default(obj, cached); },\n              function () { return _default(obj, cached); }\n            );\n        });\n    }\n\n\n    function isCacheInvalid(cached, obj) {\n      return !cached ||\n        cached.expire - +new Date() < 0  ||\n        obj.unique !== cached.unique ||\n        obj.url !== cached.url ||\n        (self.isValidItem && !self.isValidItem(cached, obj));\n    }\n\n\n    function fetch(obj) {\n      if (!obj.url) return P.resolve();\n\n      obj.key = (obj.key || obj.url);\n\n      return storage.get(obj.key)\n        // Suppress error, we can get it in private mode (Firefox)\n        .then(function (data) { return data; }, function () { return null; })\n        .then(function (cached) {\n          if (!cached && obj.cached) throw new Error('Cache not exists');\n\n          // if can't get object from store, then just load it from web.\n          obj.execute = (obj.execute !== false);\n          var shouldFetch = !cached || isCacheInvalid(cached, obj);\n\n          // If don't have to load new date - return one from cache\n          if (!obj.live && !shouldFetch) {\n            obj.type = obj.type || cached.originalType;\n            return _default(obj, cached);\n          }\n\n          // calculate loading url\n          obj.url_real = obj.url;\n          if (obj.unique) {\n            // set parameter to prevent browser cache\n            obj.url_real = obj.url + ((obj.url.indexOf('?') > 0) ? '&' : '?') + 'bag-unique=' + obj.unique;\n          }\n\n          return saveUrl(obj)\n            .then(\n              function () { return obj; },\n              function (err) {\n                if (!cached) throw err;\n\n                obj.type = obj.type || cached.originalType;\n                return _default(obj, cached);\n              }\n            );\n        });\n    }\n\n    ////////////////////////////////////////////////////////////////////////////\n    // helpers to set absolute sourcemap url\n\n    /* eslint-disable max-len */\n    var sourceMappingRe = /(?:^([ \\t]*\\/\\/[@|#][ \\t]+sourceMappingURL=)(.+?)([ \\t]*)$)|(?:^([ \\t]*\\/\\*[@#][ \\t]+sourceMappingURL=)(.+?)([ \\t]*\\*\\/[ \\t])*$)/mg;\n    /* eslint-enable max-len */\n\n    function parse_url(url) {\n      var pattern = new RegExp('^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\\\?([^#]*))?(#(.*))?');\n      var matches = url.match(pattern);\n      return {\n        scheme: matches[2],\n        authority: matches[4],\n        path: matches[5],\n        query: matches[7],\n        fragment: matches[9]\n      };\n    }\n\n    function patchMappingUrl(obj) {\n      var refUrl = parse_url(obj.url);\n      var done = false;\n      var res = obj.data.replace(sourceMappingRe, function (match, p1, p2, p3, p4, p5, p6) {\n        if (!match) return null;\n        done = true;\n        // select matched group of params\n        if (!p1) { p1 = p4; p2 = p5; p3 = p6; }\n\n        var mapUrl = parse_url(p2);\n\n        var scheme = (mapUrl.scheme ? mapUrl.scheme : refUrl.scheme) || window.location.protocol.slice(0, -1);\n        var authority = (mapUrl.authority ? mapUrl.authority : refUrl.authority) || window.location.host;\n        /* eslint-disable max-len */\n        var path = mapUrl.path[0] === '/' ? mapUrl.path : refUrl.path.split('/').slice(0, -1).join('/') + '/' + mapUrl.path;\n        /* eslint-enable max-len */\n        return p1 + (scheme + '://' + authority + path) + p3;\n      });\n      return done ? res : '';\n    }\n\n    ////////////////////////////////////////////////////////////////////////////\n\n    var handlers = {\n      'application/javascript': function injectScript(obj) {\n        var script = document.createElement('script'), txt;\n\n        // try to change sourcemap address to absolute\n        txt = patchMappingUrl(obj);\n        if (!txt) {\n          // or add script name for dev tools\n          txt = obj.data + '\\n//# sourceURL=' + obj.url;\n        }\n\n        // Have to use .text, since we support IE8,\n        // which won't allow appending to a script\n        script.text = txt;\n        head.appendChild(script);\n        return;\n      },\n\n      'text/css': function injectStyle(obj) {\n        var style = document.createElement('style'), txt;\n\n        // try to change sourcemap address to absolute\n        txt = patchMappingUrl(obj);\n        if (!txt) {\n          // or add stylesheet script name for dev tools\n          txt = obj.data + '\\n/*# sourceURL=' + obj.url + ' */';\n        }\n\n        // Needed to enable `style.styleSheet` in IE\n        style.setAttribute('type', 'text/css');\n\n        if (style.styleSheet) {\n          // We should append style element to DOM before assign css text to\n          // workaround IE bugs with `@import` and `@font-face`.\n          // https://github.com/andrewwakeling/ie-css-bugs\n          head.appendChild(style);\n\n          style.styleSheet.cssText = txt; // IE method\n        } else {\n          style.appendChild(document.createTextNode(txt)); // others\n          head.appendChild(style);\n        }\n\n        return;\n      }\n    };\n\n\n    function execute(obj) {\n      if (!obj.type) return;\n\n      // Cut off encoding if exists:\n      // application/javascript; charset=UTF-8\n      var handlerName = obj.type.split(';')[0];\n\n      // Fix outdated mime types if needed, to use single handler\n      if (handlerName === 'application/x-javascript' || handlerName === 'text/javascript') {\n        handlerName = 'application/javascript';\n      }\n\n      if (handlers[handlerName]) handlers[handlerName](obj);\n\n      return;\n    }\n\n    ////////////////////////////////////////////////////////////////////////////\n\n    //\n    // Public methods\n    //\n\n    this.require = function (resources) {\n      createStorage();\n\n      return new P(function (resolve, reject) {\n        var result = [], exec_pos = 0,\n            res = _isArray(resources) ? resources : [ resources ];\n\n        if (!resources) {\n          resolve();\n          return;\n        }\n\n        _each(res, function (r, i) { result[i] = false; });\n\n        _each(res, function (r, i) {\n          if (typeof r === 'string') res[i] = { url: r };\n\n          fetch(res[i]).then(function () {\n            // return content only, if one need full info -\n            // check input object, that will be extended.\n            result[i] = res[i].data;\n\n            var k;\n\n            for (k = exec_pos; k < result.length; k++) {\n              if (result[k] === false) break;\n              if (res[k].execute) execute(res[k]);\n            }\n\n            exec_pos = k;\n\n            if (exec_pos >= res.length) {\n              resolve(_isArray(resources) ? result : result[0]);\n            }\n          }, function (err) {\n            reject(err);\n          });\n        });\n      });\n    };\n\n\n    // Create proxy methods (init store then subcall)\n    _each([ 'remove', 'get', 'set', 'clear' ], function (method) {\n      self[method] = function () {\n        createStorage();\n        return storage[method].apply(storage, arguments);\n      };\n    });\n\n\n    this.addHandler = function (types, handler) {\n      types = _isArray(types) ? types : [ types ];\n      _each(types, function (type) { handlers[type] = handler; });\n    };\n\n\n    this.removeHandler = function (types) {\n      self.addHandler(types/*, undefined*/);\n    };\n  }\n\nexport default Bag\n","import Bag from './local'\nconst DEFAULT_OPTIONS = {\n  // 默认获取 js 来源\n  tag : ['noscript'],\n  // 默认加载资源\n  lazyload: ['//cdnjs.gtimg.com/cdnjs/libs/zepto/1.1.4/zepto.min.js'],\n  doc: document\n}\n\n/**\n * \n * 初始化\n * @export\n * @see https://github.com/nodeca/bag.js/blob/master/bag.js\n * @param {any} [option=DEFAULT_OPTIONS] \n * @param {string}  [localOptios={\n *   \tprefix: 'bq_local',\n * \t\tstores: ['indexeddb', 'websql', 'localstorage'],\n * \t\texpire: 1\n * }] \n * @returns Promise\n */\nexport function init(option = DEFAULT_OPTIONS, localOptios = {\n  \tprefix: 'bq_local',\n    // ['indexeddb', 'websql', 'localstorage']\n\t\tstores: ['indexeddb', 'websql', 'localstorage'],\n\t\texpire: 1\n}) {\n  let lazyLoad = option.lazyload || []\n  let doc = option.doc || document\n  let tag = option.tag || 'noscript'\n  let noscript = doc.querySelectorAll(tag)\n  noscript.forEach(node => {\n    let parser  = new DOMParser()\n\t\tlet html = parser.parseFromString(node.childNodes[0].nodeValue, \"text/html\")\n\t\tlet scrips = html.querySelectorAll('script')\n  \tscrips.forEach(script => {\n\t\t\tlazyLoad.push(script.getAttribute('src'))\n\t\t})\n  })\n  let bag = new Bag(localOptios)\n  return {\n    lazyLoad: lazyLoad,\n    require(_lazyLoad = lazyLoad ) {\n      return bag.require(_lazyLoad)\n    },\n    clear(expiredOnly = true) {\n      return bag.clear(expiredOnly)\n    },\n    remove(key) {\n      return bag.remove(key)\n    },\n    get(key) {\n      return bag.get(key)\n    },\n    set(key, data, expire) {\n      return bag.set(key, data, expire)\n    }\n  }\n}\n\n\n"],"names":["global","immediate","head","document","getElementsByTagName","_isArray","Array","isArray","obj","Object","prototype","toString","call","_each","iterator","forEach","i","length","k","hasOwnProperty","_default","src","val","key","P","Promise","DomStorage","namespace","self","_ns","init","resolve","remove","removeItem","set","value","expire","reject","setItem","JSON","stringify","e","name","toUpperCase","indexOf","localStorage","split","e2","get","raw","data","getItem","parse","Error","clear","expiredOnly","now","Date","p","then","exists","WebSql","db","window","openDatabase","transaction","tx","executeSql","err","readTransaction","result","rows","item","Idb","idb","indexedDB","req","open","onsuccess","target","onblocked","errorCode","onerror","onupgradeneeded","objectStoreNames","contains","deleteObjectStore","store","createObjectStore","keyPath","createIndex","unique","oncomplete","onabort","objectStore","abort","put","keyrange","IDBKeyRange","cursor","index","openCursor","bound","_cursor","primaryKey","dbName","deleteDatabase","storeAdapters","Storage","storesList","toLowerCase","console","log","createInit","_waitInit","Bag","options","prefix","timeout","isValidItem","stores","storage","createStorage","getUrl","url","xhr","XMLHttpRequest","onreadystatechange","readyState","status","responseText","getResponseHeader","statusText","send","createCacheObj","response","cacheObj","content","originalType","type","stamp","saveUrl","url_real","delay","cached","isCacheInvalid","fetch","execute","shouldFetch","live","sourceMappingRe","parse_url","pattern","RegExp","matches","match","patchMappingUrl","refUrl","done","res","replace","p1","p2","p3","p4","p5","p6","mapUrl","scheme","location","protocol","slice","authority","host","path","join","handlers","injectScript","script","createElement","txt","text","appendChild","injectStyle","style","setAttribute","styleSheet","cssText","createTextNode","handlerName","require","resources","exec_pos","r","method","apply","arguments","addHandler","types","handler","removeHandler","DEFAULT_OPTIONS","option","localOptios","lazyLoad","lazyload","doc","tag","noscript","querySelectorAll","parser","DOMParser","html","parseFromString","node","childNodes","nodeValue","scrips","push","getAttribute","bag","_lazyLoad"],"mappings":"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"}